{% load static %}

<html lang="en">
    <head>
        <title>Appointmed</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="UTF-8">

        <link rel="stylesheet" href="{% static 'css/doctor_home.css' %}">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

        <!--daypilot calendar library-->
        <script src="{% static 'js/daypilot-all.min.js' %}" async></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const dayView = new DayPilot.Calendar("dpDay", { viewType: "Day" });
                const weekView = new DayPilot.Calendar("dpWeek", { viewType: "Week" });
                const monthView = new DayPilot.Month("dpMonth", { eventHeight: 32 });

                fetch("{% url 'doctor appointment api' %}")
                    .then(response => response.json())
                    .then(data => {
                        dayView.events.list = data;
                        weekView.events.list = data;
                        monthView.events.list = data;
        
                        dayView.update();
                        weekView.update();
                        monthView.update();
                    });
        
                weekView.init();
        
                function showView(view) {
                    if (view === "Day") {
                        dayView.init();
                        dayView.style.display = "block";
                        weekView.style.display = "none";
                        monthView.style.display = "none";
                    } else if (view === "Week") {
                        dayView.style.display = "none";
                        weekView.style.display = "block";
                        monthView.style.display = "none";
                    } else if (view === "Month") {
                        monthView.init();
                        dayView.style.display = "none";
                        weekView.style.display = "none";
                        monthView.style.display = "block";
                    }
                }
        
                document.getElementById("buttonDay").addEventListener("click", function () {
                    showView("Day");
                });
        
                document.getElementById("buttonWeek").addEventListener("click", function () {
                    showView("Week");
                });
        
                document.getElementById("buttonMonth").addEventListener("click", function () {
                    showView("Month");
                });

                // initial view
                showView("Week");
            });
        </script>
        
    </head>
    
    <body>
        <div id="header-container">
            <h1 id="header-message">Hello, <i>Dr. {{ doctor.user.first_name }}</i>!</h1>

            <div id="icon-bar">
                <div id="date-n-time">
                    <p>{% now "F j, Y" %}</p>
                    <p>{% now "g:i A" %}</p>
                </div>

                <button type="button" id="note-button">note</button>
                <button type="button" id="notification-button">notification</button>
                <button type="button" id="about-button">about</button>
                <button type="button" id="user-menu-button">user</button>
            </div>
        </div>

        <div id="body-container">
            <!-- calendar from: https://code.daypilot.org/27988/html5-calendar-with-day-week-month-views-javascript-php -->
            <div id="calendar-container">
                <div class="main" style="display: flex; justify-content: flex-start;">
                        <!--filter buttons and calendar-->
                        <div style="flex-grow: 1;">
                          <div class="toolbar buttons">
                            <button id="buttonDay">Day</button>
                            <button id="buttonWeek">Week</button>
                            <button id="buttonMonth">Month</button>
                          </div>
                          <div id="dpDay"></div>
                          <div id="dpWeek"></div>
                          <div id="dpMonth"></div>
                        </div>

                        <!--3 side calendars-->
                        <div style="visibility: hidden;">
                            <div id="nav"></div>
                        </div>
                </div>

                <div id="calendar-legends">
                    <p>*icon* Accepted Request</p>
                    <p>*icon* Pending Request</p>
                    <p>*icon* Rejected Request</p>
                </div>
            </div>

            <div id="appointments-container">
                <h1>Appointments</h1>

                <div id="appointments-filters">
                    <button type="button" id="pending-filter">Pending ({x})</button>
                    <button type="button" id="canceled-filter">Canceled ({x})</button>
                </div>

                <div id="appointments-list">

                    {% if appointments|length == 0 %}
                        <p>There are no pending appointments.</p>
                    {% endif %}

                    {% for appointment in appointments %}
                        <div class="appointmentItem">
                            <div class="appointmentDetails">
                                <div class="appointmentLeft">
                                    <h1>{{ appointment.patient.user.first_name }} {{ appointment.patient.user.last_name }}</h1>
                                    <p>{{ appointment.appointment_date }}</p>
                                </div>
            
                                <div class="appointmentRight">
                                    <button type="button" class="acceptButton">Accept</button>
                                    <button type="button" class="rejectButton">Reject</button>
                                </div>
                            </div>
                            
                            <hr>
                        </div>
                    {% endfor %}
                </div>

                <p>Slots available: <i>{x}</i></p>
            </div>
        </div>
        
        <script src="{% static 'js/doctor_home.js' %}" async></script>
    </body>
</html>
